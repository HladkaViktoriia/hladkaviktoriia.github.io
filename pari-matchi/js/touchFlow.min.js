!function (t) { "use strict"; "function" == typeof define && define.amd ? define(["jquery"], t) : "object" == typeof module && module.exports ? module.exports = t : t(jQuery) }(function (t) { "use strict"; var s = "transition" in document.documentElement.style || "WebkitTransition" in document.documentElement.style, i = function (s, i) { this.opts = t.extend({}, { useMouse: !0, useWheel: !0, axis: "x", page: 0, speed: 200, side: .15, snap: !1, scrollbar: !1, scrollbarAutoHide: !0, initComplete: null, stopped: null, resizeend: null }, i), this.target = s, this.wrap = t(s), this.list = this.wrap.children(), this.wrapw = null, this.wraph = null, this.listw = null, this.listh = null, this.tmp = null, this.ticker = null, this.duration = this.opts.speed, this.side = this.opts.side, this.delay = 17, this.posx = 0, this.posy = 0, this.startx = 0, this.starty = 0, this.speedx = 0, this.speedy = 0, this.prevx = 0, this.prevy = 0, this.tempx = 0, this.tempy = 0, this.right = 0, this.bottom = 0, this.state = !1, this.link = !0, this.lastmove = null, this.scroll = {}, this.init() }; i.prototype = { init: function () { var s = this; return this.list = this.wrap.children(), this.state = !1, "string" == typeof this.opts.page && (this.opts.page = t(this.target).find(this.opts.page).eq(0).index()), this.set_limit(), this.go_page(this.opts.page), this.list.off("touchstart", this, this.touchstart).off("touchmove", this, this.touchmove).off("touchend touchcancel", this.touchend).off("transitionend", this, this.transitionend).off("wheel", this, this.wheel).off("dragstart").on("dragstart", function (t) { t.preventDefault() }).on("touchstart", this, this.touchstart).on("touchmove", this, this.touchmove).on("touchend touchcancel", this, this.touchend).on("transitionend", this, this.transitionend).on("wheel", this, this.wheel), this.opts.useMouse && this.list.off("mousedown", this, this.touchstart).on("mousedown", this, this.touchstart), t(window).off("resize", this, this.resize).on("resize", this, this.resize), this.target.removeEventListener("click", this._containerClickHandler || function () { }, !0), this._containerClickHandler = function (t) { s.link || (t.stopPropagation(), t.preventDefault()) }, this.target.addEventListener("click", this._containerClickHandler, !0), this.opts.scrollbar && this.scrollbar_init(), "function" == typeof this.opts.initComplete && this.opts.initComplete.call(this, this.get_event_data()), this }, scrollbar_init: function () { void 0 === this.scroll.wrap && (this.scroll.wrap = t('<div class="touchflow-scrollbar"><div></div></div>'), this.scroll.bar = this.scroll.wrap.find(" > div"), this.wrap.append(this.scroll.wrap), this.scrollbar_pos()) }, scrollbar_pos: function (t) { if (this.opts.scrollbar) { var s, i, o = this.scroll.wrap, e = this.scroll.bar, h = t ? "300ms" : "0ms"; "x" === this.opts.axis ? (s = this.wrapw / this.listw * 100, i = -this.posX() / this.listw * 100, o.css({ width: "100%", height: "5px", opacity: 1 }), e.css({ width: s + "%", height: "5px", left: i + "%", transition: h })) : "y" === this.opts.axis && (s = this.wraph / this.listh * 100, i = -this.posY() / this.listh * 100, o.css({ width: "5px", height: "100%", opacity: 1 }), e.css({ width: "5px", height: s + "%", top: i + "%", transition: h })), this.opts.scrollbarAutoHide && setTimeout(function () { t && o.css({ opacity: 0 }) }, 300) } }, touchstart: function (s) { var i = s.data, o = t(this).position(); i.startx = s.originalEvent.touches ? s.originalEvent.touches[0].pageX : s.pageX, i.starty = s.originalEvent.touches ? s.originalEvent.touches[0].pageY : s.pageY, i.posx = i.startx - o.left, i.posy = i.starty - o.top, "function" == typeof i.opts.stopped && 0 !== i.speedx && i.opts.stopped.call(i, i.get_event_data()), i.speedx = 0, i.speedy = 0, i.prevx = 0, i.prevy = 0, i.tempx = 0, i.tempy = 0, i.stop_animation(), i.start_animation(), i.state = !0, i.lastmove = s, s.stopPropagation(), "mousedown" == s.type && t(document).on("mousemove", i, i.touchmove).on("mouseup", i, i.touchend) }, touchmove: function (t) { var s = t.data, i = t.originalEvent.touches ? t.originalEvent.touches[0].pageX : t.pageX, o = t.originalEvent.touches ? t.originalEvent.touches[0].pageY : t.pageY, e = i - s.startx, h = o - s.starty, n = e < 0 ? -1 * e : e, a = h < 0 ? -1 * h : h, p = i - s.posx, r = o - s.posy, l = p - s.get_limit({ x: p }), u = r - s.get_limit({ y: r }); "x" == s.opts.axis && n > a ? (s.link = !1, t.preventDefault(), Math.abs(l) > 0 && (p -= l / 2), s.set_pos({ x: p })) : "y" == s.opts.axis && n < a && (s.link = !1, t.preventDefault(), Math.abs(u) > 0 && (r -= u / 2), s.set_pos({ y: r })), s.lastmove = t, t.stopPropagation() }, touchend: function (s) { var i = s.data, o = i.lastmove.originalEvent.touches ? i.lastmove.originalEvent.touches[0].pageX : i.lastmove.pageX, e = i.lastmove.originalEvent.touches ? i.lastmove.originalEvent.touches[0].pageY : i.lastmove.pageY, h = o - i.startx, n = e - i.starty, a = t(i.list).position(), p = a.left, r = a.top, l = 0; i.state = !1, i.speedx = i.tempx, i.speedy = i.tempy, "x" != i.opts.axis || i.limit_chk({ x: p }) ? "y" != i.opts.axis || i.limit_chk({ y: r }) ? "function" == typeof i.opts.stopped && i.opts.stopped.call(i, i.get_event_data()) : (l = n < 0 ? i.bottom : 0, i.stop_animation(), i.set_pos({ y: l }, i.duration)) : (l = h < 0 ? i.right : 0, i.stop_animation(), i.set_pos({ x: l }, i.duration)), setTimeout(function () { i.link = !0 }, 50), s.stopPropagation(), i.opts.useMouse && t(document).off("mousemove", i.touchmove).off("mouseup", i.touchend) }, transitionend: function (t) { var s = t.data; "function" == typeof s.opts.stopped && s.opts.stopped.call(s, s.get_event_data()), s.scrollbar_pos(!0) }, resize: function (t) { var s = t.data; clearTimeout(s.tmp), s.tmp = setTimeout(function () { s.set_limit(), s.pos_control(), "function" == typeof s.opts.resizeend && s.opts.resizeend.call(s, s.get_event_data()), s.scrollbar_pos(!0) }, 200) }, wheel: function (t) { var s = t.data, i = 0, o = {}; if (!1 === s.opts.useWheel) return !0; if (t.originalEvent.deltaY > 0) "x" === s.opts.axis ? (o = { x: (i = s.posX()) - 1 }, s.posX(i - 100)) : (o = { y: (i = s.posY()) - 1 }, s.posY(i - 100)); else { if (!(t.originalEvent.deltaY < 0)) return !0; "x" === s.opts.axis ? (o = { x: (i = s.posX()) + 1 }, s.posX(i + 100)) : (o = { y: (i = s.posY()) + 1 }, s.posY(i + 100)) } !0 === s.limit_chk(o) && t.preventDefault(), s.scrollbar_pos(!0) }, get_nearby_page: function (t) { var s = "number" == typeof t ? Math.abs(t) : null, i = [], o = this.list.offset(), e = this.list.children(), h = e.length, n = ""; "x" === this.opts.axis ? (n = "left", null === s && (s = Math.abs(o.left))) : (n = "top", null === s && (s = Math.abs(o.top))); for (var a = 0; a < h; ++a)i[a] = Math.abs(e.eq(a).offset()[n] - o[n] - s); return i.indexOf(Math.min.apply(null, i)) }, start_animation: function () { window.requestAnimationFrame ? this.ticker = requestAnimationFrame(this.move.bind(this)) : this.ticker = setTimeout(this.move.bind(this), this.delay) }, stop_animation: function () { window.requestAnimationFrame ? cancelAnimationFrame(this.ticker) : clearTimeout(this.ticker) }, move: function () { var t = this.list.position(), s = t.left, i = t.top; if (!1 === this.state) { var o = Math.abs(this.speedx), e = Math.abs(this.speedy); if (this.opts.snap && "x" === this.opts.axis && o < 10) return this.stop_animation(), void this.go_page(this.get_nearby_page(s)); if (this.opts.snap && "y" === this.opts.axis && e < 10) return this.stop_animation(), void this.go_page(this.get_nearby_page(i)); if (o < 1 && e < 1) return this.stop_animation(), "function" == typeof this.opts.stopped && 0 !== this.speedx && this.opts.stopped.call(this, this.get_event_data()), void this.scrollbar_pos(!0); this.speedx = .95 * this.speedx, this.speedy = .95 * this.speedy, s += this.speedx, i += this.speedy; var h = this.limit_chk({ x: s }), n = this.get_limit({ x: s }), a = this.limit_chk({ y: i }), p = this.get_limit({ y: i }); if (h && a) this.set_pos({ x: n, y: p }); else { if (this.set_pos({ x: s, y: i }), Math.abs(s - n) > 70) return this.stop_animation(), void this.set_pos({ x: n }, this.duration); if (Math.abs(i - p) > 70) return this.stop_animation(), void this.set_pos({ y: p }, this.duration) } } else this.tempx = s - this.prevx, this.tempy = i - this.prevy, this.prevx = s, this.prevy = i; this.scrollbar_pos(), this.start_animation() }, limit_chk: function (t) { return void 0 !== t.x ? t.x > 0 == !1 && t.x < this.right == !1 : void 0 !== t.y ? t.y > 0 == !1 && t.y < this.bottom == !1 : void 0 }, set_limit: function () { var s = 0, i = 0; this.wrapw = this.wrap.width(), this.wraph = this.wrap.height(), t(this.list.children()).each(function () { s += t(this).outerWidth(), i += t(this).outerHeight() }), this.listw = s, this.listh = i, this.wrapw < this.listw ? this.right = -(this.listw - this.wrapw) : this.right = 0, this.wraph < this.listh ? this.bottom = -(this.listh - this.wraph) : this.bottom = 0 }, get_limit: function (t) { return void 0 !== t.x ? (t.x > 0 && (t.x = 0), t.x < this.right && (t.x = this.right), t.x) : void 0 !== t.y ? (t.y > 0 && (t.y = 0), t.y < this.bottom && (t.y = this.bottom), t.y) : void 0 }, go_page: function (s) { var i = this.list.offset(), o = this.list.children().map(function () { return t(this).offset() }); if (this.opts.page = s, "x" == this.opts.axis) { var e = -(o[s].left - i.left - (o[0].left - i.left)); this.posX(e) } else if ("y" == this.opts.axis) { var h = -(o[s].top - i.top - (o[0].top - i.top)); this.posY(h) } return this }, view_page: function (t) { this.opts.page = t; var s = this.list.children().eq(t); if ("x" == this.opts.axis) { var i = s.position().left, o = s.width(), e = this.wrapw * this.side, h = this.posX(); i + h < 0 && (i = -(i - e), this.posX(i)), i + o + h > this.wrapw && (i = -(i + o - this.wrapw + e), this.posX(i)) } else if ("y" == this.opts.axis) { var n = s.position().top, a = s.height(), p = this.wraph * this.side, r = this.posY(); n + r < 0 && (n = -(n - p), this.posY(n)), n + a + r > this.wraph && (n = -(n + a - this.wraph + p), this.posY(n)) } return this }, pos_control: function () { var t = this.posX(), s = this.posY(), i = this.limit_chk({ x: t }), o = this.get_limit({ x: t }), e = this.limit_chk({ y: s }), h = this.get_limit({ y: s }); i && e || (this.set_pos({ x: t, y: s }), Math.abs(t - o) > 70 && this.set_pos({ x: o }, this.duration), Math.abs(s - h) > 70 && this.set_pos({ y: h }, this.duration)) }, set_pos: function (i, o) { i = t.extend({}, { x: 0, y: 0 }, i); var e = s ? { transition: o ? o + "ms linear" : "0ms", transform: "translate3d(" + i.x + "px, " + i.y + "px, 0px)" } : { left: i.x + "px", top: i.y + "px" }; this.list.css(e) }, posX: function (t) { if (void 0 !== t) { var s = this.get_limit({ x: t }); return "first" == t ? s = 0 : "last" == t && (s = this.right), this.stop_animation(), this.set_pos({ x: s }, this.duration), this } return this.list.position().left }, posY: function (t) { if (void 0 !== t) { var s = this.get_limit({ y: t }); return "first" == t ? s = 0 : "last" == t && (s = this.bottom), this.stop_animation(), this.set_pos({ y: s }, this.duration), this } return this.list.position().top }, get_event_data: function () { return { obj: this, target: this.target, posX: this.posX(), posY: this.posY() } } }, t.fn.touchFlow = function (s) { return this.each(function () { t.data(this, "touchFlow") || t.data(this, "touchFlow", new i(this, s)) }) } });